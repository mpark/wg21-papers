<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="mpark/wg21" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2022-10-14" />
  <title>Pattern Matching Discussion for Kona 2022</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
      div.csl-block{margin-left: 1.5em;}
      ul.task-list{list-style: none;}
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {  background-color: #f6f8fa; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span { } /* Normal */
      code span.al { color: #ff0000; } /* Alert */
      code span.an { } /* Annotation */
      code span.at { } /* Attribute */
      code span.bn { color: #9f6807; } /* BaseN */
      code span.bu { color: #9f6807; } /* BuiltIn */
      code span.cf { color: #00607c; } /* ControlFlow */
      code span.ch { color: #9f6807; } /* Char */
      code span.cn { } /* Constant */
      code span.co { color: #008000; font-style: italic; } /* Comment */
      code span.cv { color: #008000; font-style: italic; } /* CommentVar */
      code span.do { color: #008000; } /* Documentation */
      code span.dt { color: #00607c; } /* DataType */
      code span.dv { color: #9f6807; } /* DecVal */
      code span.er { color: #ff0000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #9f6807; } /* Float */
      code span.fu { } /* Function */
      code span.im { } /* Import */
      code span.in { color: #008000; } /* Information */
      code span.kw { color: #00607c; } /* Keyword */
      code span.op { color: #af1915; } /* Operator */
      code span.ot { } /* Other */
      code span.pp { color: #6f4e37; } /* Preprocessor */
      code span.re { } /* RegionMarker */
      code span.sc { color: #9f6807; } /* SpecialChar */
      code span.ss { color: #9f6807; } /* SpecialString */
      code span.st { color: #9f6807; } /* String */
      code span.va { } /* Variable */
      code span.vs { color: #9f6807; } /* VerbatimString */
      code span.wa { color: #008000; font-weight: bold; } /* Warning */
      code.diff {color: #898887}
      code.diff span.va {color: #006e28}
      code.diff span.st {color: #bf0303}
  </style>
  <style type="text/css">
body {
margin: 5em;
font-family: serif;

hyphens: auto;
line-height: 1.35;
text-align: justify;
}
@media screen and (max-width: 30em) {
body {
margin: 1.5em;
}
}
div.wrapper {
max-width: 60em;
margin: auto;
}
ul {
list-style-type: none;
padding-left: 2em;
margin-top: -0.2em;
margin-bottom: -0.2em;
}
a {
text-decoration: none;
color: #4183C4;
}
a.hidden_link {
text-decoration: none;
color: inherit;
}
li {
margin-top: 0.6em;
margin-bottom: 0.6em;
}
h1, h2, h3, h4 {
position: relative;
line-height: 1;
}
a.self-link {
position: absolute;
top: 0;
left: calc(-1 * (3.5rem - 26px));
width: calc(3.5rem - 26px);
height: 2em;
text-align: center;
border: none;
transition: opacity .2s;
opacity: .5;
font-family: sans-serif;
font-weight: normal;
font-size: 83%;
}
a.self-link:hover { opacity: 1; }
a.self-link::before { content: "§"; }
ul > li:before {
content: "\2014";
position: absolute;
margin-left: -1.5em;
}
:target { background-color: #C9FBC9; }
:target .codeblock { background-color: #C9FBC9; }
:target ul { background-color: #C9FBC9; }
.abbr_ref { float: right; }
.folded_abbr_ref { float: right; }
:target .folded_abbr_ref { display: none; }
:target .unfolded_abbr_ref { float: right; display: inherit; }
.unfolded_abbr_ref { display: none; }
.secnum { display: inline-block; min-width: 35pt; }
.header-section-number { display: inline-block; min-width: 35pt; }
.annexnum { display: block; }
div.sourceLinkParent {
float: right;
}
a.sourceLink {
position: absolute;
opacity: 0;
margin-left: 10pt;
}
a.sourceLink:hover {
opacity: 1;
}
a.itemDeclLink {
position: absolute;
font-size: 75%;
text-align: right;
width: 5em;
opacity: 0;
}
a.itemDeclLink:hover { opacity: 1; }
span.marginalizedparent {
position: relative;
left: -5em;
}
li span.marginalizedparent { left: -7em; }
li ul > li span.marginalizedparent { left: -9em; }
li ul > li ul > li span.marginalizedparent { left: -11em; }
li ul > li ul > li ul > li span.marginalizedparent { left: -13em; }
div.footnoteNumberParent {
position: relative;
left: -4.7em;
}
a.marginalized {
position: absolute;
font-size: 75%;
text-align: right;
width: 5em;
}
a.enumerated_item_num {
position: relative;
left: -3.5em;
display: inline-block;
margin-right: -3em;
text-align: right;
width: 3em;
}
div.para { margin-bottom: 0.6em; margin-top: 0.6em; text-align: justify; }
div.section { text-align: justify; }
div.sentence { display: inline; }
span.indexparent {
display: inline;
position: relative;
float: right;
right: -1em;
}
a.index {
position: absolute;
display: none;
}
a.index:before { content: "⟵"; }

a.index:target {
display: inline;
}
.indexitems {
margin-left: 2em;
text-indent: -2em;
}
div.itemdescr {
margin-left: 3em;
}
.bnf {
font-family: serif;
margin-left: 40pt;
margin-top: 0.5em;
margin-bottom: 0.5em;
}
.ncbnf {
font-family: serif;
margin-top: 0.5em;
margin-bottom: 0.5em;
margin-left: 40pt;
}
.ncsimplebnf {
font-family: serif;
font-style: italic;
margin-top: 0.5em;
margin-bottom: 0.5em;
margin-left: 40pt;
background: inherit; 
}
span.textnormal {
font-style: normal;
font-family: serif;
white-space: normal;
display: inline-block;
}
span.rlap {
display: inline-block;
width: 0px;
}
span.descr { font-style: normal; font-family: serif; }
span.grammarterm { font-style: italic; }
span.term { font-style: italic; }
span.terminal { font-family: monospace; font-style: normal; }
span.nonterminal { font-style: italic; }
span.tcode { font-family: monospace; font-style: normal; }
span.textbf { font-weight: bold; }
span.textsc { font-variant: small-caps; }
a.nontermdef { font-style: italic; font-family: serif; }
span.emph { font-style: italic; }
span.techterm { font-style: italic; }
span.mathit { font-style: italic; }
span.mathsf { font-family: sans-serif; }
span.mathrm { font-family: serif; font-style: normal; }
span.textrm { font-family: serif; }
span.textsl { font-style: italic; }
span.mathtt { font-family: monospace; font-style: normal; }
span.mbox { font-family: serif; font-style: normal; }
span.ungap { display: inline-block; width: 2pt; }
span.textit { font-style: italic; }
span.texttt { font-family: monospace; }
span.tcode_in_codeblock { font-family: monospace; font-style: normal; }
span.phantom { color: white; }

span.math { font-style: normal; }
span.mathblock {
display: block;
margin-left: auto;
margin-right: auto;
margin-top: 1.2em;
margin-bottom: 1.2em;
text-align: center;
}
span.mathalpha {
font-style: italic;
}
span.synopsis {
font-weight: bold;
margin-top: 0.5em;
display: block;
}
span.definition {
font-weight: bold;
display: block;
}
.codeblock {
margin-left: 1.2em;
line-height: 127%;
}
.outputblock {
margin-left: 1.2em;
line-height: 127%;
}
div.itemdecl {
margin-top: 2ex;
}
code.itemdeclcode {
white-space: pre;
display: block;
}
span.textsuperscript {
vertical-align: super;
font-size: smaller;
line-height: 0;
}
.footnotenum { vertical-align: super; font-size: smaller; line-height: 0; }
.footnote {
font-size: small;
margin-left: 2em;
margin-right: 2em;
margin-top: 0.6em;
margin-bottom: 0.6em;
}
div.minipage {
display: inline-block;
margin-right: 3em;
}
div.numberedTable {
text-align: center;
margin: 2em;
}
div.figure {
text-align: center;
margin: 2em;
}
table {
border: 1px solid black;
border-collapse: collapse;
margin-left: auto;
margin-right: auto;
margin-top: 0.8em;
text-align: left;
hyphens: none; 
}
td, th {
padding-left: 1em;
padding-right: 1em;
vertical-align: top;
}
td.empty {
padding: 0px;
padding-left: 1px;
}
td.left {
text-align: left;
}
td.right {
text-align: right;
}
td.center {
text-align: center;
}
td.justify {
text-align: justify;
}
td.border {
border-left: 1px solid black;
}
tr.rowsep, td.cline {
border-top: 1px solid black;
}
tr.even, tr.odd {
border-bottom: 1px solid black;
}
tr.capsep {
border-top: 3px solid black;
border-top-style: double;
}
tr.header {
border-bottom: 3px solid black;
border-bottom-style: double;
}
th {
border-bottom: 1px solid black;
}
span.centry {
font-weight: bold;
}
div.table {
display: block;
margin-left: auto;
margin-right: auto;
text-align: center;
width: 90%;
}
span.indented {
display: block;
margin-left: 2em;
margin-bottom: 1em;
margin-top: 1em;
}
ol.enumeratea { list-style-type: none; background: inherit; }
ol.enumerate { list-style-type: none; background: inherit; }

code.sourceCode > span { display: inline; }
</style>
  <link href="data:image/x-icon;base64,AAABAAIAEBAAAAEAIABoBAAAJgAAACAgAAABACAAqBAAAI4EAAAoAAAAEAAAACAAAAABACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////AIJEAACCRAAAgkQAAIJEAACCRAAAgkQAVoJEAN6CRADegkQAWIJEAACCRAAAgkQAAIJEAACCRAAA////AP///wCCRAAAgkQAAIJEAACCRAAsgkQAvoJEAP+CRAD/gkQA/4JEAP+CRADAgkQALoJEAACCRAAAgkQAAP///wD///8AgkQAAIJEABSCRACSgkQA/IJEAP99PQD/dzMA/3czAP99PQD/gkQA/4JEAPyCRACUgkQAFIJEAAD///8A////AHw+AFiBQwDqgkQA/4BBAP9/PxP/uZd6/9rJtf/bybX/upd7/39AFP+AQQD/gkQA/4FDAOqAQgBc////AP///wDKklv4jlEa/3o7AP+PWC//8+3o///////////////////////z7un/kFox/35AAP+GRwD/mVYA+v///wD///8A0Zpk+NmibP+0d0T/8evj///////+/fv/1sKz/9bCs//9/fr//////+/m2/+NRwL/nloA/5xYAPj///8A////ANKaZPjRmGH/5cKh////////////k149/3UwAP91MQD/lmQ//86rhv+USg3/m1YA/5hSAP+bVgD4////AP///wDSmmT4zpJY/+/bx///////8+TV/8mLT/+TVx//gkIA/5lVAP+VTAD/x6B//7aEVv/JpH7/s39J+P///wD///8A0ppk+M6SWP/u2sf///////Pj1f/Nj1T/2KFs/8mOUv+eWhD/lEsA/8aee/+0glT/x6F7/7J8Rvj///8A////ANKaZPjRmGH/48Cf///////+/v7/2qt//82PVP/OkFX/37KJ/86siv+USg7/mVQA/5hRAP+bVgD4////AP///wDSmmT40ppk/9CVXP/69O////////7+/v/x4M//8d/P//7+/f//////9u7n/6tnJf+XUgD/nFgA+P///wD///8A0ppk+NKaZP/RmWL/1qNy//r07///////////////////////+vXw/9akdP/Wnmn/y5FY/6JfFvj///8A////ANKaZFTSmmTo0ppk/9GYYv/Ql1//5cWm//Hg0P/x4ND/5cWm/9GXYP/RmGH/0ppk/9KaZOjVnmpY////AP///wDSmmQA0ppkEtKaZI7SmmT60ppk/9CWX//OkVb/zpFW/9CWX//SmmT/0ppk/NKaZJDSmmQS0ppkAP///wD///8A0ppkANKaZADSmmQA0ppkKtKaZLrSmmT/0ppk/9KaZP/SmmT/0ppkvNKaZCrSmmQA0ppkANKaZAD///8A////ANKaZADSmmQA0ppkANKaZADSmmQA0ppkUtKaZNzSmmTc0ppkVNKaZADSmmQA0ppkANKaZADSmmQA////AP5/AAD4HwAA4AcAAMADAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAMADAADgBwAA+B8AAP5/AAAoAAAAIAAAAEAAAAABACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////AP///wCCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAAyCRACMgkQA6oJEAOqCRACQgkQAEIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAA////AP///wD///8A////AIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRABigkQA5oJEAP+CRAD/gkQA/4JEAP+CRADqgkQAZoJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAAD///8A////AP///wD///8AgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAA4gkQAwoJEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQAxIJEADyCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAAgkQAAP///wD///8A////AP///wCCRAAAgkQAAIJEAACCRAAAgkQAAIJEAACCRAAWgkQAmIJEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAJyCRAAYgkQAAIJEAACCRAAAgkQAAIJEAACCRAAA////AP///wD///8A////AIJEAACCRAAAgkQAAIJEAACCRAAAgkQAdIJEAPCCRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAP+CRAD/gkQA/4JEAPSCRAB4gkQAAIJEAACCRAAAgkQAAIJEAAD///8A////AP///wD///8AgkQAAIJEAACCRAAAgkQASoJEANKCRAD/gkQA/4JEAP+CRAD/g0YA/39AAP9zLgD/bSQA/2shAP9rIQD/bSQA/3MuAP9/PwD/g0YA/4JEAP+CRAD/gkQA/4JEAP+CRADUgkQAToJEAACCRAAAgkQAAP///wD///8A////AP///wB+PwAAgkUAIoJEAKiCRAD/gkQA/4JEAP+CRAD/hEcA/4BBAP9sIwD/dTAA/5RfKv+viF7/vp56/76ee/+wiF7/lWAr/3YxAP9sIwD/f0AA/4RHAP+CRAD/gkQA/4JEAP+CRAD/gkQArIJEACaBQwAA////AP///wD///8A////AIBCAEBzNAD6f0EA/4NFAP+CRAD/gkQA/4VIAP92MwD/bSUA/6N1Tv/ezsL/////////////////////////////////38/D/6V3Uv9uJgD/dTEA/4VJAP+CRAD/gkQA/4JEAP+BQwD/fUAA/4FDAEj///8A////AP///wD///8AzJRd5qBlKf91NgD/dDUA/4JEAP+FSQD/cy4A/3YyAP/PuKP//////////////////////////////////////////////////////9K7qP94NQD/ciwA/4VJAP+CRAD/fkEA/35BAP+LSwD/mlYA6v///wD///8A////AP///wDdpnL/4qx3/8KJUv+PUhf/cTMA/3AsAP90LgD/4dK+/////////////////////////////////////////////////////////////////+TYxf91MAD/dTIA/31CAP+GRwD/llQA/6FcAP+gWwD8////AP///wD///8A////ANGZY/LSm2X/4ap3/92mcP+wdT3/byQA/8mwj////////////////////////////////////////////////////////////////////////////+LYxv9zLgP/jUoA/59bAP+hXAD/nFgA/5xYAPL///8A////AP///wD///8A0ppk8tKaZP/RmWL/1p9q/9ubXv/XqXj////////////////////////////7+fD/vZyG/6BxS/+gcUr/vJuE//r37f//////////////////////3MOr/5dQBf+dVQD/nVkA/5xYAP+cWAD/nFgA8v///wD///8A////AP///wDSmmTy0ppk/9KaZP/SmWP/yohJ//jo2P//////////////////////4NTG/4JDFf9lGAD/bSQA/20kAP9kGAD/fz8S/+Xb0f//////5NG9/6txN/+LOgD/m1QA/51aAP+cWAD/m1cA/5xYAP+cWADy////AP///wD///8A////ANKaZPLSmmT/0ppk/8+TWf/Unmv//v37//////////////////////+TWRr/VwsA/35AAP+ERgD/g0UA/4JGAP9lHgD/kFga/8KXX/+TRwD/jT4A/49CAP+VTQD/n10A/5xYAP+OQQD/lk4A/55cAPL///8A////AP///wD///8A0ppk8tKaZP/SmmT/y4tO/92yiP//////////////////////8NnE/8eCQP+rcTT/ez0A/3IyAP98PgD/gEMA/5FSAP+USwD/jj8A/5lUAP+JNwD/yqV2/694Mf+HNQD/jkAA/82rf/+laBj/jT4A8v///wD///8A////AP///wDSmmTy0ppk/9KaZP/LiUr/4byY///////////////////////gupX/0I5P/+Wuev/Lklz/l1sj/308AP+QSwD/ol0A/59aAP+aVQD/k0oA/8yoh///////+fXv/6pwO//Lp3v///////Pr4f+oay7y////AP///wD///8A////ANKaZPLSmmT/0ppk/8uJSv/hvJj//////////////////////+G7l//Jhkb/0ppk/96nc//fqXX/x4xO/6dkFP+QSQD/llEA/5xXAP+USgD/yaOA///////38uv/qG05/8ijdv//////8efb/6ZpLPL///8A////AP///wD///8A0ppk8tKaZP/SmmT/zIxO/9yxh///////////////////////7dbA/8iEQf/Sm2X/0Zlj/9ScZv/eqHf/2KJv/7yAQf+XTgD/iToA/5lSAP+JNgD/yKFv/611LP+HNQD/jT8A/8qmeP+kZRT/jT4A8v///wD///8A////AP///wDSmmTy0ppk/9KaZP/Pk1n/1J5q//78+//////////////////+/fv/1aFv/8iEQv/Tm2b/0ppl/9GZY//Wn2z/1pZc/9eldf/Bl2b/kUcA/4w9AP+OQAD/lUwA/59eAP+cWQD/jT8A/5ZOAP+eXADy////AP///wD///8A////ANKaZPLSmmT/0ppk/9KZY//KiEn/8d/P///////////////////////47+f/05tm/8iCP//KiEj/yohJ/8eCP//RmGH//vfy///////n1sP/rXQ7/4k4AP+TTAD/nVoA/5xYAP+cVwD/nFgA/5xYAPL///8A////AP///wD///8A0ppk8tKaZP/SmmT/0ptl/8uLTf/aq37////////////////////////////+/fz/6c2y/961jv/etY7/6Myx//78+v//////////////////////3MWv/5xXD/+ORAD/mFQA/51ZAP+cWAD/nFgA8v///wD///8A////AP///wDSmmTy0ppk/9KaZP/SmmT/0ppk/8mFRP/s1b//////////////////////////////////////////////////////////////////////////////+PD/0JFU/7NzMv+WUQD/kUsA/5tXAP+dWQDy////AP///wD///8A////ANKaZP/SmmT/0ppk/9KaZP/Sm2X/z5NZ/8yMT//z5NX/////////////////////////////////////////////////////////////////9Ofa/8yNUP/UmGH/36p5/8yTWv+qaSD/kksA/5ROAPz///8A////AP///wD///8A0ppk5NKaZP/SmmT/0ppk/9KaZP/TnGf/zY9T/82OUv/t1sD//////////////////////////////////////////////////////+7Yw//OkFX/zI5R/9OcZ//SmmP/26V0/9ymdf/BhUf/ol8R6P///wD///8A////AP///wDSmmQ80ppk9tKaZP/SmmT/0ppk/9KaZP/TnGj/zpFW/8qJSv/dson/8uHS//////////////////////////////////Lj0//etIv/y4lL/86QVf/TnGj/0ppk/9KaZP/RmWP/05xn/9ymdfjUnWdC////AP///wD///8A////ANKaZADSmmQc0ppkotKaZP/SmmT/0ppk/9KaZP/Tm2b/0Zli/8qJSf/NjlH/16Z3/+G8mP/myKr/5siq/+G8mP/Xp3f/zY5S/8qISf/RmGH/05tm/9KaZP/SmmT/0ppk/9KaZP/SmmSm0pljINWdaQD///8A////AP///wD///8A0ppkANKaZADSmmQA0ppkQtKaZMrSmmT/0ppk/9KaZP/SmmT/0ptl/9GYYf/Nj1P/y4lL/8qISP/KiEj/y4lK/82PU//RmGH/0ptl/9KaZP/SmmT/0ppk/9KaZP/SmmTO0ppkRtKaZADSmmQA0ppkAP///wD///8A////AP///wDSmmQA0ppkANKaZADSmmQA0ppkANKaZGzSmmTu0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmTw0ppkcNKaZADSmmQA0ppkANKaZADSmmQA////AP///wD///8A////ANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZBLSmmSQ0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppklNKaZBTSmmQA0ppkANKaZADSmmQA0ppkANKaZAD///8A////AP///wD///8A0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQy0ppkutKaZP/SmmT/0ppk/9KaZP/SmmT/0ppk/9KaZP/SmmT/0ppkvtKaZDbSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkAP///wD///8A////AP///wDSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkXNKaZODSmmT/0ppk/9KaZP/SmmT/0ppk5NKaZGDSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA////AP///wD///8A////ANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkBtKaZIbSmmTo0ppk6tKaZIrSmmQK0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZADSmmQA0ppkANKaZAD///8A////AP/8P///+B///+AH//+AAf//AAD//AAAP/AAAA/gAAAHwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA8AAAAPAAAADwAAAA+AAAAfwAAAP/AAAP/8AAP//gAH//+AH///4H////D//" rel="icon" />
  
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="wrapper">
<header id="title-block-header">
<h1 class="title" style="text-align:center">Pattern Matching Discussion
for Kona 2022</h1>
<table style="border:none;float:right">
  <tr>
    <td>Document #:</td>
    <td>P2688R0</td>
  </tr>
  <tr>
    <td>Date:</td>
    <td>2022-10-14</td>
  </tr>
  <tr>
    <td style="vertical-align:top">Project:</td>
    <td>Programming Language C++</td>
  </tr>
  <tr>
    <td style="vertical-align:top">Audience:</td>
    <td>
      Evolution<br>
    </td>
  </tr>
  <tr>
    <td style="vertical-align:top">Reply-to:</td>
    <td>
      Michael Park<br>&lt;<a href="mailto:mcypark@gmail.com" class="email">mcypark@gmail.com</a>&gt;<br>
    </td>
  </tr>
</table>
</header>
<div style="clear:both">
<div id="TOC" role="doc-toc">
<h1 id="toctitle">Contents</h1>
<ul>
<li><a href="#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction<span></span></a></li>
<li><a href="#motivation-and-scope" id="toc-motivation-and-scope"><span class="toc-section-number">2</span> Motivation and
Scope<span></span></a></li>
<li><a href="#history" id="toc-history"><span class="toc-section-number">3</span> History<span></span></a></li>
<li><a href="#high-level-comparison-tables" id="toc-high-level-comparison-tables"><span class="toc-section-number">4</span> High-Level Comparison
Tables<span></span></a>
<ul>
<li><a href="#matching-integrals" id="toc-matching-integrals"><span class="toc-section-number">4.1</span> Matching
Integrals<span></span></a></li>
<li><a href="#matching-strings" id="toc-matching-strings"><span class="toc-section-number">4.2</span> Matching
Strings<span></span></a></li>
<li><a href="#matching-tuples" id="toc-matching-tuples"><span class="toc-section-number">4.3</span> Matching
Tuples<span></span></a></li>
<li><a href="#matching-variants" id="toc-matching-variants"><span class="toc-section-number">4.4</span> Matching
Variants<span></span></a></li>
<li><a href="#matching-polymorphic-types" id="toc-matching-polymorphic-types"><span class="toc-section-number">4.5</span> Matching Polymorphic
Types<span></span></a></li>
<li><a href="#matching-optionals" id="toc-matching-optionals"><span class="toc-section-number">4.6</span> Matching
Optionals<span></span></a></li>
<li><a href="#matching-nested-structs-and-variants" id="toc-matching-nested-structs-and-variants"><span class="toc-section-number">4.7</span> Matching Nested Structs and
Variants<span></span></a></li>
</ul></li>
<li><a href="#design-overview" id="toc-design-overview"><span class="toc-section-number">5</span> Design Overview<span></span></a>
<ul>
<li><a href="#syntax-overview" id="toc-syntax-overview"><span class="toc-section-number">5.1</span> Syntax
Overview<span></span></a></li>
</ul></li>
<li><a href="#addressing-feedback" id="toc-addressing-feedback"><span class="toc-section-number">6</span> Addressing Feedback<span></span></a>
<ul>
<li><a href="#pattern-matching-outside-of-inspect" id="toc-pattern-matching-outside-of-inspect"><span class="toc-section-number">6.1</span> Pattern Matching Outside of
<code class="sourceCode cpp"><span class="cf">inspect</span></code><span></span></a></li>
<li><a href="#expressions-vs-bindings" id="toc-expressions-vs-bindings"><span class="toc-section-number">6.2</span> Expressions vs
Bindings<span></span></a></li>
</ul></li>
<li><a href="#observations-of-p2392" id="toc-observations-of-p2392"><span class="toc-section-number">7</span>
Observations of P2392<span></span></a>
<ul>
<li><a href="#lack-of-pattern-composition" id="toc-lack-of-pattern-composition"><span class="toc-section-number">7.1</span> Lack of Pattern
Composition<span></span></a></li>
<li><a href="#sprawling-and-repeating-structures" id="toc-sprawling-and-repeating-structures"><span class="toc-section-number">7.2</span> Sprawling and Repeating
Structures<span></span></a></li>
<li><a href="#dereference-syntax-seems-problematic" id="toc-dereference-syntax-seems-problematic"><span class="toc-section-number">7.3</span> Dereference Syntax Seems
Problematic<span></span></a>
<ul>
<li><a href="#ambiguity-with-pointer-declaration." id="toc-ambiguity-with-pointer-declaration."><span class="toc-section-number">7.3.1</span> Ambiguity with pointer
declaration.<span></span></a></li>
<li><a href="#inconsistency-and-evolution" id="toc-inconsistency-and-evolution"><span class="toc-section-number">7.3.2</span> Inconsistency and
Evolution<span></span></a></li>
<li><a href="#previous-ewg-feedback" id="toc-previous-ewg-feedback"><span class="toc-section-number">7.3.3</span> Previous EWG
Feedback<span></span></a></li>
</ul></li>
<li><a href="#non-type-variant-discriminators" id="toc-non-type-variant-discriminators"><span class="toc-section-number">7.4</span> Non-Type Variant
Discriminators<span></span></a></li>
<li><a href="#let-vs-trailing-is-_" id="toc-let-vs-trailing-is-_"><span class="toc-section-number">7.5</span>
<code class="sourceCode cpp"><span class="cf">let</span></code> vs
Trailing
<code class="sourceCode cpp"><span class="cf">is</span> _</code><span></span></a></li>
<li><a href="#is-is-an-combinator-in-disguise" id="toc-is-is-an-combinator-in-disguise"><span class="toc-section-number">7.6</span>
<code class="sourceCode cpp"><span class="cf">is</span></code> is an
<code class="sourceCode cpp"><span class="op">&amp;&amp;</span></code>
Combinator in Disguise<span></span></a></li>
</ul></li>
<li><a href="#bibliography" id="toc-bibliography"><span class="toc-section-number">8</span> References<span></span></a></li>
</ul>
</div>
<h1 data-number="1" id="introduction"><span class="header-section-number">1</span> Introduction<a href="#introduction" class="self-link"></a></h1>
<p>This paper presents an overview of structural changes that are
intended to be the next revision of <span class="citation" data-cites="P1371R3">[<a href="https://wg21.link/p1371r3" role="doc-biblioref">P1371R3</a>]</span>. It is intended to drive a
focused discussion around the fundamental structural differences of
patterns proposed in P1371 and P2392.</p>
<p>This paper presents an approach for pattern matching using
<code class="sourceCode cpp"><span class="cf">match</span></code> and
<code class="sourceCode cpp"><span class="cf">let</span></code>. The
approach attempts to structurally unify the
<code class="sourceCode cpp"><span class="cf">inspect</span></code> and
<code class="sourceCode cpp"><span class="cf">is</span></code>
constructs from <span class="citation" data-cites="P2392R1">[<a href="https://wg21.link/p2392r1" role="doc-biblioref">P2392R1</a>]</span>.</p>
<p>While the approach described in this paper does not adopt
<code class="sourceCode cpp"><span class="cf">is</span></code>/<code class="sourceCode cpp"><span class="cf">as</span></code>
directly, I want to be clear that I’m not exactly against such
facilities. The main goal of this paper is to present <a href="#lack-of-pattern-composition">Lack of Pattern Composition</a> and
<a href="#sprawling-and-repeating-structures">Sprawling and Repeating
Structures</a> as well as an alternative approach of P1371 that
addresses previous feedback given to <span class="citation" data-cites="P1371R3">[<a href="https://wg21.link/p1371r3" role="doc-biblioref">P1371R3</a>]</span>.</p>
<h1 data-number="2" id="motivation-and-scope"><span class="header-section-number">2</span> Motivation and Scope<a href="#motivation-and-scope" class="self-link"></a></h1>
<p>The goal and motivation of this paper is to make progress on pattern
matching for C++ by focusing the discussion to some of the core
structural differences in the current pattern matching proposals in
flight.</p>
<h1 data-number="3" id="history"><span class="header-section-number">3</span> History<a href="#history" class="self-link"></a></h1>
<p><span class="citation" data-cites="P1371R0">[<a href="https://wg21.link/p1371r0" role="doc-biblioref">P1371R0</a>]</span> proposed
<code class="sourceCode cpp">id</code> to introduce a new name, and for
<code class="sourceCode cpp"><span class="op">^</span>id</code> to refer
to an existing name. <span class="citation" data-cites="P1371R1">[<a href="https://wg21.link/p1371r1" role="doc-biblioref">P1371R1</a>]</span> removed the
<code class="sourceCode cpp"><span class="op">^</span></code> due to
feedback about it being a Microsoft C++ extension for smart pointers, as
well as its hindrance on code performing simple enumeration
matching.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> Color <span class="op">{</span> Red, Green, Blue <span class="op">}</span>;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">^</span>Red   <span class="op">=&gt;</span> <span class="co">// I&#39;m just trying to</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">^</span>Green <span class="op">=&gt;</span> <span class="co">// match simple enums...</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">^</span>Blue  <span class="op">=&gt;</span> <span class="co">// What&#39;s with these carets?</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><span class="citation" data-cites="P1371R1">[<a href="https://wg21.link/p1371r1" role="doc-biblioref">P1371R1</a>]</span> and <span class="citation" data-cites="P1371R2">[<a href="https://wg21.link/p1371r2" role="doc-biblioref">P1371R2</a>]</span> kept
<code class="sourceCode cpp">id</code> introducing a new name, but
replaced <code class="sourceCode cpp"><span class="op">^</span>id</code>
with <code class="sourceCode cpp"><span class="cf">case</span> id</code>
to refer to an existing name and
<code class="sourceCode cpp"><span class="cf">let</span> id</code> to
explicitly introduce a new name.</p>
<p>One of the motivations for this was to make simple code such as
enumeration matching familiar again:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> Color <span class="op">{</span> Red, Green, Blue <span class="op">}</span>;</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> Red   <span class="op">=&gt;</span> <span class="co">// Huh, just looks like `switch` now.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> Green <span class="op">=&gt;</span> <span class="co">// ...</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> Blue  <span class="op">=&gt;</span> <span class="co">// ...</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The <code class="sourceCode cpp"><span class="cf">case</span></code>
and <code class="sourceCode cpp"><span class="cf">let</span></code>
applied recursively to identifiers to allow patterns such as <code class="sourceCode cpp"><span class="cf">case</span> <span class="op">[</span>a, b<span class="op">]</span></code>
to match against existing <code class="sourceCode cpp">a</code> and
<code class="sourceCode cpp">b</code>, and <code class="sourceCode cpp"><span class="cf">let</span> <span class="op">[</span>x, y<span class="op">]</span></code>
to introduce new names <code class="sourceCode cpp">x</code> and
<code class="sourceCode cpp">y</code>. This recursive behavior received
positive feedback from EWG in Cologne 2019:</p>
<blockquote>
<p>“We support the authors’ direction of
<code class="sourceCode cpp"><span class="cf">let</span></code> and
<code class="sourceCode cpp"><span class="cf">case</span></code> modes
applying to subpatterns.”:</p>
<p>SF: 7, F: 7, N: 5, A: 4, SA: 0</p>
</blockquote>
<p>The problem with this approach appeared to be due to the overriding
behavior of the
<code class="sourceCode cpp"><span class="cf">case</span></code> and
<code class="sourceCode cpp"><span class="cf">let</span></code>. For
example, constructs such as <code class="sourceCode cpp"><span class="cf">case</span> <span class="op">[</span>a, b, <span class="cf">let</span> x<span class="op">]</span></code>
were allowed to match against existing
<code class="sourceCode cpp">a</code> and
<code class="sourceCode cpp">b</code> for the first two elements and
bind <code class="sourceCode cpp">x</code> to the third.</p>
<p>In more complex examples however, it becomes more difficult to parse
through which names are new and which refer to existing.</p>
<p>For example in <code class="sourceCode cpp"><span class="cf">let</span> <span class="op">[</span>a, <span class="cf">case</span> <span class="op">[</span><span class="cf">let</span> b, c, d<span class="op">]</span>, <span class="op">[</span>e<span class="op">]]</span></code>,
<code class="sourceCode cpp">a</code>,
<code class="sourceCode cpp">b</code>,
<code class="sourceCode cpp">e</code> are new names and
<code class="sourceCode cpp">c</code>,
<code class="sourceCode cpp">d</code> refer to existing names.</p>
<p>In response, <span class="citation" data-cites="P1371R3">[<a href="https://wg21.link/p1371r3" role="doc-biblioref">P1371R3</a>]</span> chose to keep
<code class="sourceCode cpp"><span class="cf">case</span></code> and
drop <code class="sourceCode cpp"><span class="cf">let</span></code>.
Because the top-level already had
<code class="sourceCode cpp"><span class="cf">let</span></code> behavior
in that it introduced new names, we already effectively had “recursive
<code class="sourceCode cpp"><span class="cf">let</span></code>”. We
really only needed to provide a way to specify an existing name. This
led to <code class="sourceCode cpp"><span class="cf">case</span></code>
becoming non-recursive.</p>
<p>At this point, there were several push backs:</p>
<ul>
<li><blockquote>
<p>“We shouldn’t to bifurcate expressions like this.”</p>
</blockquote>
<p>Some expressions didn’t need
<code class="sourceCode cpp"><span class="cf">case</span></code> (e.g.,
<code class="sourceCode cpp"><span class="dv">0</span></code>), but some
did (e.g., <code class="sourceCode cpp">id</code>). If
<code class="sourceCode cpp"><span class="cf">case</span> expr</code> is
pattern matching syntax for expressions, that would at least be
consistent.</p>
<p>This paper aims to address this concern by not requiring
<code class="sourceCode cpp"><span class="cf">case</span></code> for
expressions at all.</p></li>
<li><blockquote>
<p>“Declaration of new names should have an introducer like most other
places in the language.”</p>
</blockquote>
<p>The comment is in regard to code like this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Some people found it surprising that that would introduce a new name,
as most identifiers are introduced with an introducer. Notable
exceptions being lambda captures and structured bindings. Even then,
<code class="sourceCode cpp"><span class="op">[</span>x, y<span class="op">]()</span> <span class="op">{}</span></code>
doesn’t introduce <code class="sourceCode cpp">x</code> and
<code class="sourceCode cpp">y</code> out of thin-air, it captures
existing <code class="sourceCode cpp">x</code> and
<code class="sourceCode cpp">y</code> at the same time. Though <code class="sourceCode cpp"><span class="op">[</span>x<span class="op">=</span><span class="dv">0</span>, y<span class="op">=</span><span class="dv">1</span><span class="op">]()</span> <span class="op">{}</span></code>
actually do. Structured bindings at least has the
<code class="sourceCode cpp"><span class="kw">auto</span></code> in
front, like: <code class="sourceCode cpp"><span class="kw">auto</span> <span class="op">[</span>x, y<span class="op">]</span></code>
which doesn’t apply to the <code class="sourceCode cpp">x</code> and
<code class="sourceCode cpp">y</code> at all, but does hint that we’re
in a declaration context.</p>
<p>This paper aims to address this concern by reintroducing
<code class="sourceCode cpp"><span class="cf">let</span></code> for new
names.</p></li>
</ul>
<h1 data-number="4" id="high-level-comparison-tables"><span class="header-section-number">4</span> High-Level Comparison Tables<a href="#high-level-comparison-tables" class="self-link"></a></h1>
<h2 data-number="4.1" id="matching-integrals"><span class="header-section-number">4.1</span> Matching Integrals<a href="#matching-integrals" class="self-link"></a></h2>
<table>
<thead>
<tr class="header">
<th><div style="text-align:center">
<strong>This Paper</strong>
</div></th>
<th><div style="text-align:center">
<strong>P2392</strong>
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><div>

<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>x <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span> <span class="op">=&gt;</span> <span class="op">{</span> cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got zero&quot;</span>; <span class="op">}</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="op">=&gt;</span> <span class="op">{</span> cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got one&quot;</span>; <span class="op">}</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  _ <span class="op">=&gt;</span> <span class="op">{</span> cout <span class="op">&lt;&lt;</span> <span class="st">&quot;don&#39;t care&quot;</span>; <span class="op">}</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">is</span> <span class="dv">0</span> <span class="op">=&gt;</span> <span class="op">{</span> cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got zero&quot;</span>; <span class="op">}</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">is</span> <span class="dv">1</span> <span class="op">=&gt;</span> <span class="op">{</span> cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got one&quot;</span>; <span class="op">}</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">is</span> _ <span class="op">=&gt;</span> <span class="op">{</span> cout <span class="op">&lt;&lt;</span> <span class="st">&quot;don&#39;t care&quot;</span>; <span class="op">}</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
</tr>
</tbody>
</table>
<h2 data-number="4.2" id="matching-strings"><span class="header-section-number">4.2</span> Matching Strings<a href="#matching-strings" class="self-link"></a></h2>
<table>
<thead>
<tr class="header">
<th><div style="text-align:center">
<strong>This Paper</strong>
</div></th>
<th><div style="text-align:center">
<strong>P2392</strong>
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><div>

<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>s <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;foo&quot;</span> <span class="op">=&gt;</span> <span class="op">{</span> cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got foo&quot;</span>; <span class="op">}</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;bar&quot;</span> <span class="op">=&gt;</span> <span class="op">{</span> cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got bar&quot;</span>; <span class="op">}</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  _ <span class="op">=&gt;</span> <span class="op">{</span> cout <span class="op">&lt;&lt;</span> <span class="st">&quot;don&#39;t care&quot;</span>; <span class="op">}</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">is</span> <span class="st">&quot;foo&quot;</span> <span class="op">=&gt;</span> <span class="op">{</span> cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got foo&quot;</span>; <span class="op">}</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">is</span> <span class="st">&quot;bar&quot;</span> <span class="op">=&gt;</span> <span class="op">{</span> cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got bar&quot;</span>; <span class="op">}</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">is</span> _ <span class="op">=&gt;</span> <span class="op">{</span> cout <span class="op">&lt;&lt;</span> <span class="st">&quot;don&#39;t care&quot;</span>; <span class="op">}</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
</tr>
</tbody>
</table>
<h2 data-number="4.3" id="matching-tuples"><span class="header-section-number">4.3</span> Matching Tuples<a href="#matching-tuples" class="self-link"></a></h2>
<table>
<thead>
<tr class="header">
<th><div style="text-align:center">
<strong>This Paper</strong>
</div></th>
<th><div style="text-align:center">
<strong>P2392</strong>
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><div>

<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>p <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span><span class="dv">0</span>, <span class="dv">0</span><span class="op">]</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;on origin&quot;</span>;</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span><span class="dv">0</span>, <span class="cf">let</span> y<span class="op">]</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;on y-axis at &quot;</span> <span class="op">&lt;&lt;</span> y;</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span><span class="cf">let</span> x, <span class="dv">0</span><span class="op">]</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;on x-axis at &quot;</span> <span class="op">&lt;&lt;</span> x;</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">let</span> <span class="op">[</span>x, y<span class="op">]</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> x <span class="op">&lt;&lt;</span> <span class="ch">&#39;,&#39;</span> <span class="op">&lt;&lt;</span> y;</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">is</span> <span class="op">[</span><span class="dv">0</span>, <span class="dv">0</span><span class="op">]</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;on origin&quot;</span>;</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span>_, y<span class="op">]</span> <span class="cf">is</span> <span class="op">[</span><span class="dv">0</span>, _<span class="op">]</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;on y-axis at &quot;</span> <span class="op">&lt;&lt;</span> y;</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span>x, _<span class="op">]</span> <span class="cf">is</span> <span class="op">[</span>_, <span class="dv">0</span><span class="op">]</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;on x-axis at &quot;</span> <span class="op">&lt;&lt;</span> x;</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span>x, y<span class="op">]</span> <span class="cf">is</span> _ <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> x <span class="op">&lt;&lt;</span> <span class="ch">&#39;,&#39;</span> <span class="op">&lt;&lt;</span> y;</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
</tr>
</tbody>
</table>
<h2 data-number="4.4" id="matching-variants"><span class="header-section-number">4.4</span> Matching Variants<a href="#matching-variants" class="self-link"></a></h2>
<table>
<thead>
<tr class="header">
<th><div style="text-align:center">
<strong>This Paper</strong>
</div></th>
<th><div style="text-align:center">
<strong>P2392</strong>
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><div>

<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>v <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">&gt;</span> <span class="cf">let</span> i32 <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got int32: &quot;</span> <span class="op">&lt;&lt;</span> i32;</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span><span class="dt">int64_t</span><span class="op">&gt;</span> <span class="cf">let</span> i64 <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got int64: &quot;</span> <span class="op">&lt;&lt;</span> i64;</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span><span class="dt">float</span><span class="op">&gt;</span> <span class="cf">let</span> f <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got float: &quot;</span> <span class="op">&lt;&lt;</span> f;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> <span class="cf">let</span> d <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got double: &quot;</span> <span class="op">&lt;&lt;</span> d;</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  i32 <span class="cf">as</span> <span class="dt">int32_t</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got int32: &quot;</span> <span class="op">&lt;&lt;</span> i32;</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  i64 <span class="cf">as</span> <span class="dt">int64_t</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got int32: &quot;</span> <span class="op">&lt;&lt;</span> i64;</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  f <span class="cf">as</span> <span class="dt">float</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got float: &quot;</span> <span class="op">&lt;&lt;</span> f;</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  d <span class="cf">as</span> <span class="dt">double</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got double: &quot;</span> <span class="op">&lt;&lt;</span> d;</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
</tr>
<tr class="even">
<td><div>

<div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>v <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>std<span class="op">::</span>integral<span class="op">&gt;</span> <span class="cf">let</span> i <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got integral: &quot;</span> <span class="op">&lt;&lt;</span> i;</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>std<span class="op">::</span>floating_point<span class="op">&gt;</span> <span class="cf">let</span> f <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got floating point: &quot;</span> <span class="op">&lt;&lt;</span> f;</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Unsupported.</span></span></code></pre></div>

</div></td>
</tr>
<tr class="odd">
<td><div>

<div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>v <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span><span class="dt">int32_t</span><span class="op">&gt;</span> <span class="cf">let</span> i32 <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got i32: &quot;</span> <span class="op">&lt;&lt;</span> i32;</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span><span class="kw">auto</span><span class="op">&gt;</span> <span class="cf">let</span> x <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;got something else: &quot;</span> <span class="op">&lt;&lt;</span> x;</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Unsupported.</span></span></code></pre></div>

</div></td>
</tr>
</tbody>
</table>
<h2 data-number="4.5" id="matching-polymorphic-types"><span class="header-section-number">4.5</span> Matching Polymorphic Types<a href="#matching-polymorphic-types" class="self-link"></a></h2>
<table>
<thead>
<tr class="header">
<th><div style="text-align:center">
<strong>This Paper</strong>
</div></th>
<th><div style="text-align:center">
<strong>P2392</strong>
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><div>

<div class="sourceCode" id="cb16"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> get_area<span class="op">(</span><span class="kw">const</span> Shape<span class="op">&amp;</span> shape<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> shape <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>Circle<span class="op">&gt;</span>    <span class="cf">let</span> <span class="op">[</span>r<span class="op">]</span>    <span class="op">=&gt;</span> <span class="fl">3.14</span> <span class="op">*</span> r <span class="op">*</span> r;</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>Rectangle<span class="op">&gt;</span> <span class="cf">let</span> <span class="op">[</span>w, h<span class="op">]</span> <span class="op">=&gt;</span> w <span class="op">*</span> h;</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span>;</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb17"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> get_area<span class="op">(</span><span class="kw">const</span> Shape<span class="op">&amp;</span> shape<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="cf">inspect</span> <span class="op">(</span>shape<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span>r<span class="op">]</span>    <span class="cf">as</span> Circle    <span class="op">=&gt;</span> <span class="fl">3.14</span> <span class="op">*</span> r <span class="op">*</span> r;</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span>w, h<span class="op">]</span> <span class="cf">as</span> Rectangle <span class="op">=&gt;</span> w <span class="op">*</span> h;</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span>;</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
</tr>
</tbody>
</table>
<h2 data-number="4.6" id="matching-optionals"><span class="header-section-number">4.6</span> Matching Optionals<a href="#matching-optionals" class="self-link"></a></h2>
<table>
<thead>
<tr class="header">
<th><div style="text-align:center">
<strong>This Paper</strong>
</div></th>
<th><div style="text-align:center">
<strong>P2392</strong>
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><div>

<div class="sourceCode" id="cb18"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> f<span class="op">(</span><span class="kw">const</span> optional<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&amp;</span> opt<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  opt <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">let</span> <span class="op">?</span>x <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>      cout <span class="op">&lt;&lt;</span> <span class="st">&quot;optional is storing: &quot;</span> <span class="op">&lt;&lt;</span> x;</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>      cout <span class="op">&lt;&lt;</span> <span class="st">&quot;optional is empty&quot;</span>;</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span>;</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb19"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> f<span class="op">(</span><span class="kw">const</span> optional<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&amp;</span> opt<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">inspect</span> <span class="op">(</span>opt<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>x <span class="cf">is</span> _ <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>      cout <span class="op">&lt;&lt;</span> <span class="st">&quot;optional is storing: &quot;</span> <span class="op">&lt;&lt;</span> x;</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>      cout <span class="op">&lt;&lt;</span> <span class="st">&quot;optional is empty&quot;</span>;</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
</tr>
<tr class="even">
<td><div>

<div class="sourceCode" id="cb20"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> f<span class="op">(</span><span class="kw">const</span> std<span class="op">::</span>optional<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&amp;</span> opt<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>opt <span class="cf">match</span> <span class="cf">let</span> <span class="op">?</span>x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;optional is storing: &quot;</span> <span class="op">&lt;&lt;</span> x;</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;optional is empty&quot;</span>;</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb21"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> f<span class="op">(</span><span class="kw">const</span> std<span class="op">::</span>optional<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&amp;</span> opt<span class="op">)</span> <span class="op">{</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span><span class="kw">auto</span> <span class="op">*</span>x <span class="cf">is</span> _ <span class="op">=</span> opt<span class="op">)</span> <span class="op">{</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;optional is storing: &quot;</span> <span class="op">&lt;&lt;</span> x;</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> <span class="st">&quot;optional is empty&quot;</span>;</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
</tr>
</tbody>
</table>
<h2 data-number="4.7" id="matching-nested-structs-and-variants"><span class="header-section-number">4.7</span> Matching Nested Structs and
Variants<a href="#matching-nested-structs-and-variants" class="self-link"></a></h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Rgb <span class="op">{</span> <span class="dt">int</span> r, g, b; <span class="op">}</span>;</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Hsv <span class="op">{</span> <span class="dt">int</span> h, s, v; <span class="op">}</span>;</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Color <span class="op">=</span> variant<span class="op">&lt;</span>Rgb, Hsv<span class="op">&gt;</span>;</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Quit <span class="op">{}</span>;</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Move <span class="op">{</span> <span class="dt">int</span> x, y; <span class="op">}</span>;</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Write <span class="op">{</span> string s; <span class="op">}</span>;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> ChangeColor <span class="op">{</span> Color c; <span class="op">}</span>;</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Command <span class="op">=</span> variant<span class="op">&lt;</span>Quit, Move, Write, ChangeColor<span class="op">&gt;</span>;</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>Command cmd <span class="op">=</span> ChangeColor <span class="op">{</span> Hsv <span class="op">{</span> <span class="dv">0</span>, <span class="dv">160</span>, <span class="dv">255</span> <span class="op">}</span> <span class="op">}</span>;</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th><div style="text-align:center">
<strong>This Paper</strong>
</div></th>
<th><div style="text-align:center">
<strong>P2392</strong>
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><div>

<div class="sourceCode" id="cb23"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>cmd <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>Quit<span class="op">&gt;</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>Move<span class="op">&gt;</span> <span class="cf">let</span> <span class="op">[</span>x, y<span class="op">]</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>Write<span class="op">&gt;</span> <span class="cf">let</span> <span class="op">[</span>text<span class="op">]</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>ChangeColor<span class="op">&gt;</span> <span class="op">[&lt;</span>Rgb<span class="op">&gt;</span> <span class="cf">let</span> <span class="op">[</span>r, g, b<span class="op">]]</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>ChangeColor<span class="op">&gt;</span> <span class="op">[&lt;</span>Hsv<span class="op">&gt;</span> <span class="cf">let</span> <span class="op">[</span>h, s, v<span class="op">]]</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  _ <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb24"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>cmd<span class="op">)</span> <span class="op">{</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">is</span> Quit <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span>x, y<span class="op">]</span> <span class="cf">as</span> Move <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span>text<span class="op">]</span> <span class="cf">as</span> Write <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">[[</span><span class="at">r</span>,<span class="at"> g</span>,<span class="at"> b</span><span class="op">]]</span> <span class="cf">as</span> ChangeColor <span class="cf">as</span> <span class="op">[</span>Rgb<span class="op">]</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">[[</span><span class="at">h</span>,<span class="at"> s</span>,<span class="at"> v</span><span class="op">]]</span> <span class="cf">as</span> ChangeColor <span class="cf">as</span> <span class="op">[</span>Hsv<span class="op">]</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  _ <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
</tr>
</tbody>
</table>
<h1 data-number="5" id="design-overview"><span class="header-section-number">5</span> Design Overview<a href="#design-overview" class="self-link"></a></h1>
<p>The overall idea is to introduce a single
<code class="sourceCode cpp"><span class="cf">match</span></code>
construct, along with a context-sensitive keyword
<code class="sourceCode cpp"><span class="cf">let</span></code>.
Together they can be used to select a branch, test whether a value
matches a single pattern, and in
<code class="sourceCode cpp"><span class="cf">if</span></code>/<code class="sourceCode cpp"><span class="cf">while</span></code>
statements.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>expr <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  pattern1 <span class="op">=&gt;</span> statement1;</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  pattern2 <span class="op">=&gt;</span> statement2;</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><code class="sourceCode cpp"><span class="cf">let</span></code>
denotes that an identifier is a new name rather than an existing
name.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">42</span>;</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>expr <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  x <span class="op">=&gt;</span> <span class="op">...</span> <span class="co">// match against existing `x`</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">let</span> x <span class="op">=&gt;</span> <span class="op">...</span> <span class="co">// introduce new x.</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The following is used to match a value against a single pattern.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>expr <span class="cf">match</span> pattern</span></code></pre></div>
<p>The following is the match expression being used within an
<code class="sourceCode cpp"><span class="cf">if</span></code>
statement.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>expr <span class="cf">match</span> <span class="op">[</span><span class="dv">0</span>, <span class="cf">let</span> foo<span class="op">])</span> <span class="op">{</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// `foo` is available</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>A optional guard can be added for a single pattern match as well:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pair<span class="op">&lt;</span><span class="dt">int</span>, <span class="dt">int</span><span class="op">&gt;</span> fetch<span class="op">(</span><span class="dt">int</span> id<span class="op">)</span>;</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> is_acceptable<span class="op">(</span><span class="dt">int</span> id, <span class="dt">int</span> abs_limit<span class="op">)</span> <span class="op">{</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> fetch<span class="op">(</span>id<span class="op">)</span> <span class="cf">match</span> <span class="cf">let</span> <span class="op">[</span>min, max<span class="op">]</span> <span class="cf">if</span> min <span class="op">&gt;=</span> <span class="op">-</span>abs_limit <span class="op">&amp;&amp;</span> max <span class="op">&lt;=</span> abs_limit;</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The scope of the bindings introduced by
<code class="sourceCode cpp"><span class="cf">let</span></code> are as
follows:</p>
<ul>
<li>If the pattern is left of
<code class="sourceCode cpp"><span class="op">=&gt;</span></code>, the
scope of the binding is the corresponding statement.</li>
<li>If the pattern is in a <em>expr</em>
<code class="sourceCode cpp"><span class="cf">match</span></code>
<em>pattern</em> <em>guard<sub>opt</sub></em> expression, the scope of
the binding is the expression unless:</li>
<li>If the construct immediately enclosing the expression is an
<code class="sourceCode cpp"><span class="cf">if</span></code> or
<code class="sourceCode cpp"><span class="cf">while</span></code>
statement, the scope of the binding is the
<code class="sourceCode cpp"><span class="cf">if</span></code> or
<code class="sourceCode cpp"><span class="cf">while</span></code>
statement.</li>
</ul>
<h2 data-number="5.1" id="syntax-overview"><span class="header-section-number">5.1</span> Syntax Overview<a href="#syntax-overview" class="self-link"></a></h2>
<blockquote>
<div class="line-block"><em>expression</em>
<code class="sourceCode cpp"><span class="cf">match</span></code>
<em>pattern</em> <em>guard<sub>opt</sub></em></div>
</blockquote>
<blockquote>
<div class="line-block"><em>expression</em>
<code class="sourceCode cpp"><span class="cf">match</span></code>
<em>trailing-return-type<sub>opt</sub></em>
<code class="sourceCode cpp"><span class="op">{</span></code><br />
    <em>pattern</em> <em>guard<sub>opt</sub></em>
<code class="sourceCode cpp"><span class="op">=&gt;</span></code>
<em>statement</em><br />
    …<br />
<code class="sourceCode cpp"><span class="op">}</span></code></div>
</blockquote>
<blockquote>
<div class="line-block"><em>guard</em>:<br />
    <code class="sourceCode cpp"><span class="cf">if</span></code>
<em>expression</em></div>
</blockquote>
<blockquote>
<div class="line-block"><em>pattern</em>:<br />
    <code class="sourceCode cpp">_</code><br />
    <em>expression</em><br />
    <em>type-id</em><br />
    <em>concept</em><br />
    <code class="sourceCode cpp"><span class="op">(</span></code>
<em>pattern</em>
<code class="sourceCode cpp"><span class="op">)</span></code><br />
    <code class="sourceCode cpp"><span class="op">&lt;</span></code>
<em>discriminator</em>
<code class="sourceCode cpp"><span class="op">&gt;</span></code>
<em>pattern<sub>opt</sub></em><br />
    <code class="sourceCode cpp"><span class="op">[</span></code>
<em>pattern<sub>0</sub></em> <code class="sourceCode cpp">,</code>
<em>pattern<sub>1</sub></em> <code class="sourceCode cpp">,</code> …
<code class="sourceCode cpp">,</code> <em>pattern<sub>N</sub></em>
<code class="sourceCode cpp"><span class="op">]</span></code><br />
    <code class="sourceCode cpp"><span class="op">[</span></code>
<em>designator<sub>0</sub></em>
<code class="sourceCode cpp"><span class="op">:</span></code>
<em>pattern<sub>0</sub></em> <code class="sourceCode cpp">,</code>
<em>designator<sub>1</sub></em>
<code class="sourceCode cpp"><span class="op">:</span></code>
<em>pattern<sub>1</sub></em> <code class="sourceCode cpp">,</code> …
<code class="sourceCode cpp">,</code> <em>designator<sub>N</sub></em> :
<em>pattern<sub>N</sub></em>
<code class="sourceCode cpp"><span class="op">]</span></code><br />
    <code class="sourceCode cpp"><span class="op">?</span></code>
<em>pattern</em><br />
    <em>expression</em>
<code class="sourceCode cpp"><span class="op">:</span></code>
<em>pattern</em><br />
    <em>pattern</em>
<code class="sourceCode cpp"><span class="op">&amp;&amp;</span></code>
<em>pattern</em><br />
    <em>pattern</em>
<code class="sourceCode cpp"><span class="op">||</span></code>
<em>pattern</em><br />
    <code class="sourceCode cpp"><span class="cf">let</span></code>
<em>let-pattern</em></div>
</blockquote>
<blockquote>
<div class="line-block"><em>let-pattern</em>:<br />
    <code class="sourceCode cpp">_</code><br />
    <em>identifier</em><br />
    <code class="sourceCode cpp"><span class="op">(</span></code>
<em>let-pattern</em>
<code class="sourceCode cpp"><span class="op">)</span></code><br />
    <code class="sourceCode cpp"><span class="op">&lt;</span></code>
<em>discriminator</em>
<code class="sourceCode cpp"><span class="op">&gt;</span></code>
<em>let-pattern<sub>opt</sub></em><br />
    <code class="sourceCode cpp"><span class="op">[</span></code>
<em>let-pattern<sub>0</sub></em> <code class="sourceCode cpp">,</code>
<em>let-pattern<sub>1</sub></em> <code class="sourceCode cpp">,</code> …
<code class="sourceCode cpp">,</code> <em>let-pattern<sub>N</sub></em>
<code class="sourceCode cpp"><span class="op">]</span></code><br />
    <code class="sourceCode cpp"><span class="op">[</span></code>
<em>designator<sub>0</sub></em>
<code class="sourceCode cpp"><span class="op">:</span></code>
<em>let-pattern<sub>0</sub></em> <code class="sourceCode cpp">,</code>
<em>designator<sub>1</sub></em>
<code class="sourceCode cpp"><span class="op">:</span></code>
<em>let-pattern<sub>1</sub></em> <code class="sourceCode cpp">,</code> …
<code class="sourceCode cpp">,</code> <em>designator<sub>N</sub></em> :
<em>let-pattern<sub>N</sub></em>
<code class="sourceCode cpp"><span class="op">]</span></code><br />
    <code class="sourceCode cpp"><span class="op">?</span></code>
<em>let-pattern</em><br />
    <em>expression</em>
<code class="sourceCode cpp"><span class="op">:</span></code>
<em>let-pattern</em></div>
</blockquote>
<blockquote>
<div class="line-block"><em>discriminator</em>: one of<br />
    <code class="sourceCode cpp"><span class="kw">auto</span></code>,
<em>concept</em>, <em>type-id</em>, <em>constant-expression</em></div>
</blockquote>
<h1 data-number="6" id="addressing-feedback"><span class="header-section-number">6</span> Addressing Feedback<a href="#addressing-feedback" class="self-link"></a></h1>
<h2 data-number="6.1" id="pattern-matching-outside-of-inspect"><span class="header-section-number">6.1</span> Pattern Matching Outside of
<code class="sourceCode cpp"><span class="cf">inspect</span></code><a href="#pattern-matching-outside-of-inspect" class="self-link"></a></h2>
<p>This paper proposes a
<code class="sourceCode cpp"><span class="cf">match</span></code>
construct which can be used as a selection mechanism, <code class="sourceCode cpp">expr <span class="cf">match</span> <span class="op">{</span> p1 <span class="op">=&gt;</span> s1; <span class="op">...</span> <span class="op">}</span></code>
as well as <code class="sourceCode cpp">expr <span class="cf">match</span> pattern</code>
expression. These correspond to
<code class="sourceCode cpp"><span class="cf">inspect</span></code> and
<code class="sourceCode cpp"><span class="cf">is</span></code> of P2392
respectively.</p>
<p>This was a piece of feedback from P2392 which is to allow pattern
matching outside of
<code class="sourceCode cpp"><span class="cf">inspect</span></code>
which only allowed to select a branch.</p>
<h2 data-number="6.2" id="expressions-vs-bindings"><span class="header-section-number">6.2</span> Expressions vs Bindings<a href="#expressions-vs-bindings" class="self-link"></a></h2>
<p>The <a href="#history">History</a> section covered the previous
attempts around
<code class="sourceCode cpp"><span class="cf">case</span></code> and
<code class="sourceCode cpp"><span class="cf">let</span></code>, during
which the following feedback were given:</p>
<blockquote>
<p>“We shouldn’t to bifurcate expressions like this.”</p>
</blockquote>
<p>That is, expressions are just expressions without needing anything
everywhere else in the language. This is the case in this paper. That
is, <code class="sourceCode cpp">x</code> is an expression referring to
an existing variable like it does everywhere else in the language.</p>
<blockquote>
<p>“Declarations of new names should have an introducer like most other
places.”</p>
</blockquote>
<p>New names need the
<code class="sourceCode cpp"><span class="cf">let</span></code>
introducer to introduce bindings, just like other new names in most
other places in the language.</p>
<blockquote>
<p>“I don’t want the documentation of pattern matching to have to
mention a caveat that <code class="sourceCode cpp">x</code> is a new
name and therefore shadows an existing variable.”</p>
</blockquote>
<p>As mentioned above, <code class="sourceCode cpp">x</code> is an
expression that refers to an existing variable.</p>
<h1 data-number="7" id="observations-of-p2392"><span class="header-section-number">7</span> Observations of P2392<a href="#observations-of-p2392" class="self-link"></a></h1>
<p>The following are a collection of observations P2392 as I best as I
understand. Apologies for any inaccuracies.</p>
<h2 data-number="7.1" id="lack-of-pattern-composition"><span class="header-section-number">7.1</span> Lack of Pattern Composition<a href="#lack-of-pattern-composition" class="self-link"></a></h2>
<p>Consider the example: <a href="#matching-nested-structs-and-variants">Matching Nested Structs and
Variants</a>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Rgb <span class="op">{</span> <span class="dt">int</span> r, g, b; <span class="op">}</span>;</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Hsv <span class="op">{</span> <span class="dt">int</span> h, s, v; <span class="op">}</span>;</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Color <span class="op">=</span> variant<span class="op">&lt;</span>Rgb, Hsv<span class="op">&gt;</span>;</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Quit <span class="op">{}</span>;</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Move <span class="op">{</span> <span class="dt">int</span> x, y; <span class="op">}</span>;</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Write <span class="op">{</span> string s; <span class="op">}</span>;</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> ChangeColor <span class="op">{</span> Color c; <span class="op">}</span>;</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Command <span class="op">=</span> variant<span class="op">&lt;</span>Quit, Move, Write, ChangeColor<span class="op">&gt;</span>;</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>Color c <span class="op">=</span> Rgb <span class="op">{</span> <span class="dv">0</span>, <span class="dv">160</span>, <span class="dv">255</span> <span class="op">}</span>;</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>Command cmd <span class="op">=</span> ChangeColor <span class="op">{</span> c <span class="op">}</span>;</span></code></pre></div>
<p>The following is what it would look like to match a
<code class="sourceCode cpp">Color</code>:</p>
<table>
<thead>
<tr class="header">
<th><div style="text-align:center">
<strong>This Paper</strong>
</div></th>
<th><div style="text-align:center">
<strong>P2392</strong>
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><div>

<div class="sourceCode" id="cb31"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>c <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>Rgb<span class="op">&gt;</span> <span class="cf">let</span> <span class="op">[</span>r, g, b<span class="op">]</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb32"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span>r, g, b<span class="op">]</span> <span class="cf">as</span> Rgb <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
</tr>
</tbody>
</table>
<p>Now consider the code that matches a
<code class="sourceCode cpp">ChangeColor</code> which contains
<code class="sourceCode cpp">Color</code>:</p>
<table>
<thead>
<tr class="header">
<th><div style="text-align:center">
<strong>This Paper</strong>
</div></th>
<th><div style="text-align:center">
<strong>P2392</strong>
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><div>

<div class="sourceCode" id="cb33"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>c <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>ChangeColor<span class="op">&gt;</span> <span class="op">[&lt;</span>Rgb<span class="op">&gt;</span> <span class="cf">let</span> <span class="op">[</span>r, g, b<span class="op">]]</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb34"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">[[</span><span class="at">r</span>,<span class="at"> g</span>,<span class="at"> b</span><span class="op">]]</span> <span class="cf">as</span> ChangeColor <span class="cf">as</span> <span class="op">[</span>Rgb<span class="op">]</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
</tr>
</tbody>
</table>
<p>The pattern <code class="sourceCode cpp"><span class="op">&lt;</span>Rgb<span class="op">&gt;</span> <span class="cf">let</span> <span class="op">[</span>r, g, b<span class="op">]</span></code>
which matches a <code class="sourceCode cpp">Color</code> is composed
verbatim when a <code class="sourceCode cpp">Color</code> is composed
within <code class="sourceCode cpp">ChangeColor</code>. The pattern
<code class="sourceCode cpp"><span class="op">[</span>r, g, b<span class="op">]</span> <span class="cf">as</span> Rgb</code>
in the P2392 example do not compose this way.</p>
<p>This means that the patterns in P2392 don’t compose in the same way
that the values they describe. The mechanism used in P2392 seem more
like chaining of operations rather than composition of patterns. I
believe that this is a big loss in usability and consider it to be the
biggest fundamental difference.</p>
<h2 data-number="7.2" id="sprawling-and-repeating-structures"><span class="header-section-number">7.2</span> Sprawling and Repeating
Structures<a href="#sprawling-and-repeating-structures" class="self-link"></a></h2>
<p>Consider matching a pair of
<code class="sourceCode cpp"><span class="dt">int</span></code>s and we
want to test first element for
<code class="sourceCode cpp"><span class="dv">0</span></code> and bind
the second.</p>
<table>
<thead>
<tr class="header">
<th><div style="text-align:center">
<strong>This Paper</strong>
</div></th>
<th><div style="text-align:center">
<strong>P2392</strong>
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><div>

<div class="sourceCode" id="cb35"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>c <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span><span class="dv">0</span>, <span class="cf">let</span> y<span class="op">]</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb36"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">[</span>_, y<span class="op">]</span> <span class="cf">is</span> <span class="op">[</span><span class="dv">0</span>, _<span class="op">]</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
</tr>
</tbody>
</table>
<p>We see that the structure of pair, <code class="sourceCode cpp"><span class="op">[</span>_, _<span class="op">]</span></code>,
is repeated in P2392.</p>
<p>The repeated structure starts to spread with
<code class="sourceCode cpp"><span class="cf">as</span></code>
conversions in play. Consider the example: <a href="#matching-nested-structs-and-variants">Matching Nested Structs and
Variants</a>:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Rgb <span class="op">{</span> <span class="dt">int</span> r, g, b; <span class="op">}</span>;</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Hsv <span class="op">{</span> <span class="dt">int</span> h, s, v; <span class="op">}</span>;</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Color <span class="op">=</span> variant<span class="op">&lt;</span>Rgb, Hsv<span class="op">&gt;</span>;</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Quit <span class="op">{}</span>;</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Move <span class="op">{</span> <span class="dt">int</span> x, y; <span class="op">}</span>;</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Write <span class="op">{</span> string s; <span class="op">}</span>;</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> ChangeColor <span class="op">{</span> Color c; <span class="op">}</span>;</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Command <span class="op">=</span> variant<span class="op">&lt;</span>Quit, Move, Write, ChangeColor<span class="op">&gt;</span>;</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>Command cmd <span class="op">=</span> ChangeColor <span class="op">{</span> Rgb <span class="op">{</span> <span class="dv">0</span>, <span class="dv">160</span>, <span class="dv">255</span> <span class="op">}</span> <span class="op">}</span>;</span></code></pre></div>
<p>Suppose we want to test for specific values of
<code class="sourceCode cpp">r</code> and
<code class="sourceCode cpp">g</code>:</p>
<table>
<thead>
<tr class="header">
<th><div style="text-align:center">
<strong>This Paper</strong>
</div></th>
<th><div style="text-align:center">
<strong>P2392</strong>
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><div>

<div class="sourceCode" id="cb38"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>c <span class="cf">match</span> <span class="op">{</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>ChangeColor<span class="op">&gt;</span> <span class="op">[&lt;</span>Rgb<span class="op">&gt;</span> <span class="op">[</span><span class="dv">0</span>, <span class="dv">160</span>, <span class="cf">let</span> b<span class="op">]]</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// use `b` here</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>

</div></td>
<td><div>

<div class="sourceCode" id="cb39"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">[[</span><span class="at">_</span>,<span class="at"> _</span>,<span class="at"> b</span><span class="op">]]</span> <span class="cf">as</span> ChangeColor</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>              <span class="cf">as</span> <span class="op">[</span>Rgb<span class="op">]</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>              <span class="cf">is</span> <span class="op">[[</span><span class="dv">0</span>,<span class="at"> </span><span class="dv">160</span>,<span class="at"> _</span><span class="op">]]</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// use `b` here</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>

</div></td>
</tr>
</tbody>
</table>
<p>Now the structure of <code class="sourceCode cpp"><span class="op">[[</span><span class="at">_</span>,<span class="at"> _</span>,<span class="at"> _</span><span class="op">]]</span></code>
need to be repeated, and they’re even further away. In my opinion, this
is even more difficult to parse through and understand the structure of
the value.</p>
<h2 data-number="7.3" id="dereference-syntax-seems-problematic"><span class="header-section-number">7.3</span> Dereference Syntax Seems
Problematic<a href="#dereference-syntax-seems-problematic" class="self-link"></a></h2>
<p>The use of
<code class="sourceCode cpp"><span class="op">*</span></code>
<em>pattern</em> syntax seems problematic for multiple reasons.</p>
<h3 data-number="7.3.1" id="ambiguity-with-pointer-declaration."><span class="header-section-number">7.3.1</span> Ambiguity with pointer
declaration.<a href="#ambiguity-with-pointer-declaration." class="self-link"></a></h3>
<div class="sourceCode" id="cb40"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  x <span class="cf">is</span> _ <span class="op">=&gt;</span> <span class="co">// ...</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">*</span>y <span class="cf">is</span> _ <span class="op">=&gt;</span> <span class="co">// binds `y` to `*v`</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> x <span class="op">=</span> v;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> <span class="op">*</span>y <span class="op">=</span> v; <span class="co">// pointer declaration</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> <span class="op">*</span>y <span class="cf">is</span> _ <span class="op">=</span> v; <span class="co">// the `is` makes this not be a pointer declaration?</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> <span class="op">&amp;</span>y <span class="cf">is</span> _ <span class="op">=</span> v; <span class="co">// the `is` doesn&#39;t change that this is a reference?</span></span></code></pre></div>
<h3 data-number="7.3.2" id="inconsistency-and-evolution"><span class="header-section-number">7.3.2</span> Inconsistency and Evolution<a href="#inconsistency-and-evolution" class="self-link"></a></h3>
<div class="sourceCode" id="cb41"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">is</span> <span class="op">&amp;</span>a <span class="op">=&gt;</span> <span class="co">// matches if `v == &amp;a`</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">is</span> <span class="op">*</span>a <span class="op">=&gt;</span> <span class="co">// matches if `v &amp;&amp; *v == a`</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This is because
<code class="sourceCode cpp"><span class="op">*</span></code> is a
pattern but
<code class="sourceCode cpp"><span class="op">&amp;</span></code> is
not. Aside from being a bit odd, I view this as a problem for the
evolution of pattern matching since this means that no other unary
expressions can later become a pattern.</p>
<ol type="a">
<li>Are we sure that folks won’t be confused by the inconsistency?</li>
<li>Are we confident that
<code class="sourceCode cpp"><span class="op">*</span></code> is the
only unary expression we’ll ever want to make into a pattern?</li>
</ol>
<h3 data-number="7.3.3" id="previous-ewg-feedback"><span class="header-section-number">7.3.3</span> Previous EWG Feedback<a href="#previous-ewg-feedback" class="self-link"></a></h3>
<p><span class="citation" data-cites="P1371R0">[<a href="https://wg21.link/p1371r0" role="doc-biblioref">P1371R0</a>]</span> had proposed
<code class="sourceCode cpp"><span class="op">*</span> pattern</code>
syntax and presented in EWG Kona 2019, the overwhelming feedback was to
not use that syntax since it is too confusing with expressions.</p>
<p>I agree with this sentiment, considering a simple example from <a href="#inconsistency-and-evolution">Inconsistency and Evolution</a>.</p>
<h2 data-number="7.4" id="non-type-variant-discriminators"><span class="header-section-number">7.4</span> Non-Type Variant
Discriminators<a href="#non-type-variant-discriminators" class="self-link"></a></h2>
<p>Consider a variant with short-string optimization using a predicate
as a discriminator rather than an explicitly stored value. This example
is adapted from Bjarne Stroustrup’s pattern matching presentation at
Urbana-Champaign 2014 <span class="citation" data-cites="PatMatPres">[<a href="#ref-PatMatPres" role="doc-biblioref">PatMatPres</a>]</span>.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> String <span class="op">{</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">enum</span> StorageKind <span class="op">{</span> Local, Remote <span class="op">}</span>;</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  StorageKind index<span class="op">()</span> <span class="kw">const</span>;</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">char</span> <span class="op">*</span>data<span class="op">()</span>;</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> size;</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">union</span> <span class="op">{</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> local<span class="op">[</span><span class="dv">32</span><span class="op">]</span>;</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> <span class="op">{</span> <span class="dt">char</span> <span class="op">*</span>ptr; <span class="dt">int</span> unused_allocated_space; <span class="op">}</span> remote;</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span>;</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>
<p>The discriminator is <code class="sourceCode cpp">StorageKind</code>,
retrieved via an
<code class="sourceCode cpp">index<span class="op">()</span></code>
function as per current variant-like protocol:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>StorageKind String<span class="op">::</span>index<span class="op">()</span> <span class="kw">const</span> <span class="op">{</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> size <span class="op">&gt;</span> <span class="kw">sizeof</span><span class="op">(</span>local<span class="op">)</span> <span class="op">?</span> Remote <span class="op">:</span> Local;</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Ultimately, after opting into the rest of variant-like protocol the
use looks like this:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span><span class="op">*</span> String<span class="op">::</span>data<span class="op">()</span> <span class="op">{</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="cf">inspect</span> <span class="op">(*</span><span class="kw">this</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>Local<span class="op">&gt;</span> <span class="cf">let</span> local <span class="op">=&gt;</span> local;</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>Remote<span class="op">&gt;</span> <span class="cf">let</span> remote <span class="op">=&gt;</span> remote<span class="op">.</span>ptr;</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span>;</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>where <code class="sourceCode cpp">Local</code> and
<code class="sourceCode cpp">Remote</code> are not types, but rather
<code class="sourceCode cpp"><span class="kw">enum</span></code>
values.</p>
<p>In section 3.5.9 of <span class="citation" data-cites="P2392R1">[<a href="https://wg21.link/p2392r1" role="doc-biblioref">P2392R1</a>]</span>, the following example
appears:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">// short string optimization</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span><span class="op">*</span> String<span class="op">::</span>data<span class="op">()</span> <span class="op">{</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">inspect</span> <span class="op">(*</span><span class="kw">this</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span>i<span class="op">]</span> <span class="cf">is</span> Local <span class="op">=&gt;</span> <span class="cf">return</span> i;</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span>r<span class="op">]</span> <span class="cf">is</span> Remote <span class="op">=&gt;</span> <span class="cf">return</span> r<span class="op">.</span>ptr;</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>But this example doesn’t really seem to work. As far as I can
understand, the types corresponding to the discriminators have to be
used in order to trigger the <code class="sourceCode cpp"><span class="kw">operator</span> <span class="cf">is</span></code>/<code class="sourceCode cpp"><span class="kw">operator</span> <span class="cf">as</span></code>
mechanism. For example, the <code class="sourceCode cpp">Local</code>
example needs to be something like <code class="sourceCode cpp"><span class="cf">is</span> <span class="dt">char</span><span class="op">[</span><span class="dv">32</span><span class="op">]</span></code>.
The <code class="sourceCode cpp">Remote</code> example seems to not
really be spellable at all since the type is anonymous.</p>
<h2 data-number="7.5" id="let-vs-trailing-is-_"><span class="header-section-number">7.5</span>
<code class="sourceCode cpp"><span class="cf">let</span></code> vs
Trailing
<code class="sourceCode cpp"><span class="cf">is</span> _</code><a href="#let-vs-trailing-is-_" class="self-link"></a></h2>
<p>As far as I understand, the following is a consistency that P2392
tries to make.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> <span class="op">&lt;</span>names<span class="op">&gt;</span> <span class="cf">is</span> <span class="op">&lt;</span>constraint<span class="op">&gt;</span> <span class="op">=</span> v;</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co">//   ^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> <span class="op">&lt;</span>names<span class="op">&gt;</span> <span class="cf">as</span> <span class="op">&lt;</span>target<span class="op">&gt;</span> <span class="op">=</span> v;</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co">//   ^^^^^^^^^^^^^^^^^^^</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>names<span class="op">&gt;</span> <span class="cf">is</span> <span class="op">&lt;</span>constraint<span class="op">&gt;</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co">//  ^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>names<span class="op">&gt;</span> <span class="cf">as</span> <span class="op">&lt;</span>target<span class="op">&gt;</span> <span class="op">=&gt;</span> <span class="op">...</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co">//  ^^^^^^^^^^^^^^^^^^^</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>When neither constraint nor target exists, it can be omitted in
familiar fashion in the declaration form.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">auto</span> <span class="op">&lt;</span>names<span class="op">&gt;</span> <span class="op">=</span> v;  <span class="co">// e.g., auto [x, y] = v;</span></span></code></pre></div>
<p>This doesn’t work in
<code class="sourceCode cpp"><span class="cf">inspect</span></code> and
a trailing
<code class="sourceCode cpp"><span class="cf">is</span> _</code> is
required.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>names<span class="op">&gt;</span> <span class="cf">is</span> _ <span class="op">=&gt;</span> <span class="co">// e.g., x is _ =&gt; ...</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                    <span class="co">//       *x is _ =&gt; ...</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                    <span class="co">//       [x, y] is _ =&gt; ...</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The use of
<code class="sourceCode cpp"><span class="cf">let</span></code> seem to
be a slightly better spelling than a trailing
<code class="sourceCode cpp"><span class="cf">is</span> _</code>.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="cf">inspect</span> <span class="op">(</span>v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">let</span> <span class="op">&lt;</span>names<span class="op">&gt;</span> <span class="op">=&gt;</span> <span class="co">// e.g., let x =&gt; ...</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                   <span class="co">//       let ?x =&gt; ...</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                   <span class="co">//       let [x, y] =&gt; ...</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The trailing
<code class="sourceCode cpp"><span class="cf">is</span> _</code> appears
in other contexts as well such as:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span><span class="kw">auto</span> <span class="op">*</span>x <span class="cf">is</span> _ <span class="op">=</span> opt<span class="op">)</span> <span class="op">{</span> <span class="op">...</span> <span class="op">}</span></span></code></pre></div>
<p>which is expected to be a common use case.</p>
<h2 data-number="7.6" id="is-is-an-combinator-in-disguise"><span class="header-section-number">7.6</span>
<code class="sourceCode cpp"><span class="cf">is</span></code> is an
<code class="sourceCode cpp"><span class="op">&amp;&amp;</span></code>
Combinator in Disguise<a href="#is-is-an-combinator-in-disguise" class="self-link"></a></h2>
<p>A P2392 pattern like <code class="sourceCode cpp"><span class="op">[</span>a, b, c<span class="op">]</span> <span class="cf">is</span> <span class="op">[</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span><span class="op">]</span></code>
is really two patterns combined with
<code class="sourceCode cpp"><span class="op">&amp;&amp;</span></code>.
Consider that the following has equivalent meaning: <code class="sourceCode cpp"><span class="op">[</span>a, b, c<span class="op">]</span> <span class="cf">is</span> _ <span class="op">&amp;&amp;</span> <span class="cf">is</span> <span class="op">[</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span><span class="op">]</span></code>.
In the approach presented in this paper, this would be <code class="sourceCode cpp"><span class="cf">let</span> <span class="op">[</span>a, b, c<span class="op">]</span> <span class="op">&amp;&amp;</span> <span class="op">[</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span><span class="op">]</span></code>.</p>
<h1 data-number="8" id="bibliography"><span class="header-section-number">8</span> References<a href="#bibliography" class="self-link"></a></h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="1" role="doc-bibliography">
<div id="ref-P1371R0" class="csl-entry" role="doc-biblioentry">
[P1371R0] Sergei Murzin, Michael Park, David Sankel, Dan Sarginson.
2019-01-21. Pattern Matching. <a href="https://wg21.link/p1371r0"><div class="csl-block">https://wg21.link/p1371r0</div></a>
</div>
<div id="ref-P1371R1" class="csl-entry" role="doc-biblioentry">
[P1371R1] Sergei Murzin, Michael Park, David Sankel, Dan Sarginson.
2019-06-17. Pattern Matching. <a href="https://wg21.link/p1371r1"><div class="csl-block">https://wg21.link/p1371r1</div></a>
</div>
<div id="ref-P1371R2" class="csl-entry" role="doc-biblioentry">
[P1371R2] Sergei Murzin, Michael Park, David Sankel, Dan Sarginson.
2020-01-13. Pattern Matching. <a href="https://wg21.link/p1371r2"><div class="csl-block">https://wg21.link/p1371r2</div></a>
</div>
<div id="ref-P1371R3" class="csl-entry" role="doc-biblioentry">
[P1371R3] Michael Park, Bruno Cardoso Lopes, Sergei Murzin, David
Sankel, Dan Sarginson, Bjarne Stroustrup. 2020-09-15. Pattern Matching.
<a href="https://wg21.link/p1371r3"><div class="csl-block">https://wg21.link/p1371r3</div></a>
</div>
<div id="ref-P2392R1" class="csl-entry" role="doc-biblioentry">
[P2392R1] Herb Sutter. 2021-07-19. Pattern matching using
&amp;quot;is&amp;quot; and &amp;quot;as&amp;quot; <a href="https://wg21.link/p2392r1"><div class="csl-block">https://wg21.link/p2392r1</div></a>
</div>
<div id="ref-PatMatPres" class="csl-entry" role="doc-biblioentry">
[PatMatPres] Yuriy Solodkyy, Gabriel Dos Reis, and Bjarne Stroustrup.
<span>“Pattern Matching for C++”</span> presentation at Urbana-Champaign
2014.
</div>
</div>
</div>
</div>
</body>
</html>
